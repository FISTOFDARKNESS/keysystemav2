<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Key Panel</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#06060b;color:#dff9ff;font-family:Inter,Segoe UI,Arial;display:flex;align-items:center;justify-content:center;min-height:100vh;margin:0}
.card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:28px;border-radius:12px;box-shadow:0 8px 40px rgba(0,200,255,0.06);width:420px;text-align:center}
h1{color:#00d4ff;margin:0 0 8px;font-size:20px}
.key{font-family:Consolas,monospace;font-size:18px;padding:12px;background:#071019;border-radius:8px;margin:12px 0;color:#bff6ff}
button{background:#00d4ff;border:0;padding:10px 16px;border-radius:8px;cursor:pointer;color:#001;font-weight:700}
button.secondary{background:#7c34ff;color:#fff;margin-left:8px}
small{color:#9fb6c9;display:block;margin-top:8px}
.row{display:flex;justify-content:center;gap:8px;align-items:center}
</style>
</head>
<body>
<div class="card">
  <h1>Painel Key</h1>
  <div id="key" class="key">Carregando...</div>
  <div class="row">
    <button id="refresh">Atualizar</button>
  </div>
  <small id="info"></small>
</div>
<script>
const SITE_URL = window.location.origin;
function getLocalVisitor() { return localStorage.getItem('visitor_id') || null; }
function setLocalVisitor(v) { if (v) localStorage.setItem('visitor_id', v); }
async function loadKey(){
  const visitor = getLocalVisitor();
  const headers = visitor ? { 'x-visitor-id': visitor } : {};
  try {
    const res = await fetch(SITE_URL + '/.netlify/functions/get-or-create-key', { method:'GET', headers, credentials: 'include' });
    if (!res.ok) { document.getElementById('key').textContent = 'Sem key ativa'; return; }
    const j = await res.json();
    if (j.visitor_id) setLocalVisitor(j.visitor_id);
    document.getElementById('key').textContent = j.key;
    document.getElementById('info').textContent = 'Expira em: ' + new Date(j.expires_at).toLocaleString();
  } catch(e) {
    document.getElementById('key').textContent = 'Erro';
    console.error(e);
  }
}
document.getElementById('refresh').addEventListener('click', loadKey);
loadKey();
</script>
</body>
</html>
